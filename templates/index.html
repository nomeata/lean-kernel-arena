{% extends "base.html" %}

{% block static_path %}{% endblock %}

{% block style %}
.checker-name { font-weight: 600; }
.bg-success { background-color: #d4edda; }
.bg-danger { background-color: #f8d7da; }
.bg-warning { background-color: #fff3cd; }
.text-muted { color: #6c757d; }
.banner {
    width: 100%;
    max-width: 100%;
    height: auto;
    margin: 1rem 0 2rem 0;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
{% endblock %}

{% block content %}
<section>
    <img src="static/kernel-arena-banner-under-construction.jpg" alt="Lean Kernel Arena" class="banner">
    
    <p>
        The <strong>Lean Kernel Arena</strong> presents, tests and benchmarks proof checkers for the <a href="https://lean-lang.org/">Lean Theorem Prover</a>.
    </p>

</section>

<section>
    {% if checkers %}
    <div style="overflow-x:auto">
    <table class="striped">
        <thead>
            <tr>
                <th>Checker</th>
                <th>Version</th>
                <th class="text-center" title="Correctly accepted valid proofs">‚úÖ</th>
                <th class="text-center" title="Correctly rejected invalid proofs">‚ùå</th>
                <th class="text-center" title="Tests declined to process">üö´</th>
                <th class="text-right" title="Wall time to process mathlib test">‚è±Ô∏è Wall</th>
                <th class="text-right" title="CPU time to process mathlib test">‚è±Ô∏è CPU</th>
                <th class="text-right" title="Peak memory usage for mathlib test">üß† RSS</th>
            </tr>
        </thead>
        <tbody>
            {% for checker in checkers %}
            <tr>
                <td><a href="checker/{{ checker.name }}/">{{ checker.name }}</a></td>
                <td>{{ checker.version }}</td>
                <td class="text-center {% if checker.stats.accept_correct == checker.stats.accept_total and checker.stats.accept_total > 0 %}bg-success{% elif checker.stats.accept_correct < checker.stats.accept_total %}bg-error{% endif %}">
                    {{ checker.stats.accept_correct }}/{{ checker.stats.accept_total }}
                </td>
                <td class="text-center {% if checker.stats.reject_correct == checker.stats.reject_total and checker.stats.reject_total > 0 %}bg-success{% elif checker.stats.reject_correct < checker.stats.reject_total %}bg-error{% endif %}">
                    {{ checker.stats.reject_correct }}/{{ checker.stats.reject_total }}
                </td>
                <td class="text-center">
                    {{ checker.stats.declined_count }}
                </td>
                <td class="text-right">
                    {% if checker.stats.mathlib_time is not none %}
                        {{ format_duration(checker.stats.mathlib_time) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if checker.stats.get('mathlib_instructions', 0) > 0 and instructions_per_second > 0 %}
                        <span title="{{ format_instructions(checker.stats.get('mathlib_instructions', 0)) }} instructions">{{ format_duration(convert_instructions_to_time(checker.stats.get('mathlib_instructions', 0), instructions_per_second)) }}</span>
                    {% elif checker.stats.mathlib_cpu_time is not none %}
                        {{ format_duration(checker.stats.mathlib_cpu_time) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if checker.stats.mathlib_max_rss is not none %}
                        {{ format_memory(checker.stats.mathlib_max_rss) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% else %}
    <p class="text-grey">No checkers defined.</p>
    {% endif %}
</section>

<section>
    <header>
        <h3>Details</h3>
    </header>

    <p>
        The data above is generated by running each checker on a suite of test inputs. Test inputs are either valid proofs that should be accepted (column ‚úÖ), or invalid proofs that should be rejected (column ‚ùå). The checkers are scored based on their ability to correctly accept and reject these tests.
    </p>

    <p>
        The time and space measurements refer to the <tt>mathlib</tt> test case, the largest correct test in the suite. 
        {% if instructions_per_second > 0 %}
            CPU time measurements are based on instruction counts when available, converted to equivalent time using an average rate of {{ "%.1f"|format(instructions_per_second / 1000000000) }} billion instructions per second across all measurements.
        {% endif %}
    </p>

    <p>
        Checkers that do not implement all features may decline to process certain tests (column üö´). These tests are not taken into account for correctness scoring.
    </p>

    <p>
        For more details on the interface for external checks, and how to submit these, see the project's <a href="https://github.com/leanprover/lean-kernel-arena"><tt>README.md</tt> file</a>.
    </p>

    <p>
        A tarball of the test suite (excluding large tests) is available for download: <a href="lean-arena-tests.tar.gz"><tt>lean-arena-tests.tar.gz</tt></a> ({{ tarball_info.good_count }} good tests, {{ tarball_info.bad_count }} bad tests, {{ format_memory(tarball_info.tarball_size) }}). 
        The tarball contains subdirectories <tt>good/</tt> and <tt>bad/</tt> based on expected results, making it easy to test your own checker implementation.
    </p>

    <p>
        We are interested in extending our test suite, in particular tests that should be rejected are a useful help for authors of new kernel checkers.
    </p>

</section>
{% endblock %}
