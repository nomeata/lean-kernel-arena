{% extends "base.html" %}

{% block static_path %}../../{% endblock %}

{% block title %}{{ checker.name }} - Lean Kernel Arena{% endblock %}

{% block h1 %}<a href="../../">Lean Kernel Arena</a> / {{ checker.name }}
    {% if checker.url %}
    <a href="{{ checker.url }}"><img src="../../static/github-mark.svg" style="height: 0.7em" alt="GitHub"/></a>
    {% endif %}
{% endblock %}

{% block style %}
.bg-success { background-color: #d4edda; }
.bg-error { background-color: #f8d7da; }
.bg-warning { background-color: #fff3cd; }
.link-group {
    margin-top: 0.5rem;
}
.link-group a {
    margin-right: 1rem;
    text-decoration: none;
    padding: 0.25rem 0.5rem;
    background-color: #e9ecef;
    border-radius: 3px;
    font-size: 0.9rem;
}
.link-group a:hover {
    background-color: #d3d8e0;
}
details summary {
    cursor: pointer;
    user-select: none;
    margin-bottom: 0.5rem;
}
section pre, details pre {
    background-color: #f5f5f5;
    padding: 0.5rem;
    border-radius: 4px;
    overflow-x: auto;
    max-height: 300px;
    overflow-y: auto;
}
{% endblock %}

{% block content %}
<section>
    <header>
        <h3>Checker Information</h3>
    </header>
    <div class="link-group">
        {% if checker_links.declaration_url %}
        <a href="{{ checker_links.declaration_url }}" target="_blank"> Declaration</a>
        {% endif %}
        {% if checker_links.source_url %}
        <a href="{{ checker_links.source_url }}" target="_blank"> Source</a>
        {% endif %}
    </div>
</section>

<section>
    <header>
        <h3>Statistics</h3>
    </header>
    <div class="row">
        <div class="col-4">
            <div class="card">
                <header>Completeness (rightfully accepted tests)</header>
                <p class="is-center" style="font-size: 2rem;">
                    {{ checker.stats.accept_correct }}/{{ checker.stats.accept_total }}
                </p>
            </div>
        </div>
        <div class="col-4">
            <div class="card">
                <header>Soundness (rightfully rejected tests)</header>
                <p class="is-center" style="font-size: 2rem;">
                    {{ checker.stats.reject_correct }}/{{ checker.stats.reject_total }}
                </p>
            </div>
        </div>
        <div class="col-4">
            <div class="card">
                <header>Declined tests</header>
                <p class="is-center" style="font-size: 2rem;">
                    {{ checker.stats.declined_count }}
                </p>
            </div>
        </div>
    </div>
</section>

<section>
    <header>
        <h3>Test Results</h3>
    </header>
    {% if results %}
    <table class="striped">
        <thead>
            <tr>
                <th>Test</th>
                <th>Expected</th>
                <th>Result</th>
                <th class="text-right">Wall Time</th>
                <th class="text-right">CPU Time</th>
                <th class="text-right">Max RSS</th>
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
            <tr>
                <td><a href="#test-{{ result.test }}">{{ result.test }}</a></td>
                <td>{{ result.expected or '-' }}</td>
                <td class="{% if result.status == 'accepted' %}bg-success{% elif result.status == 'rejected' %}bg-error{% else %}bg-warning{% endif %}">
                    {{ result.status }}
                </td>
                <td class="text-right">{{ format_duration(result.wall_time or 0) }}</td>
                <td class="text-right">
                    {% if result.cpu_time and result.cpu_time > 0 %}
                        {{ format_duration(result.cpu_time) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if result.max_rss and result.max_rss > 0 %}
                        {{ format_memory(result.max_rss) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% for result in results %}
    <h4 id="test-{{ result.test }}">{{ result.test }}</h4>
    
    <p><b>Test details:</b>
        <span class="{% if result.expected == 'accept' %}bg-success{% elif result.expected == 'reject' %}bg-error{% else %}bg-warning{% endif %}" style="padding: 0.2em 0.5em; border-radius: 3px;">{{ result.expected }}</span>
        路 {% if result.test_stats %}
          {{ result.test_stats.size_str }}
        路 {{ result.test_stats.lines_str }} lines
          {% endif %}
    </p>
    <div class="link-group">
        {% if result.test_links.declaration_url %}
        <a href="{{ result.test_links.declaration_url }}" target="_blank"> Declaration</a>
        {% endif %}
        {% if result.test_links.source_url %}
        <a href="{{ result.test_links.source_url }}" target="_blank"> Source</a>
        {% endif %}
    </div>
    
    <p>
      <b>Test result:</b>
        <span class="{% if result.status == 'accepted' %}bg-success{% elif result.status == 'rejected' %}bg-error{% else %}bg-warning{% endif %}" style="padding: 0.2em 0.5em; border-radius: 3px;">{{ result.status }}</span>
        路 exit code {{ result.exit_code }}
        路 wall: {{ format_duration(result.wall_time or 0) }}
        {% if result.cpu_time and result.cpu_time > 0 %}
        路 cpu: {{ format_duration(result.cpu_time) }}
        {% endif %}
        {% if result.max_rss and result.max_rss > 0 %}
        路 rss: {{ format_memory(result.max_rss) }}
        {% endif %}
    </p>
    {% if result.stdout %}
    <h5>stdout:</h5>
    <pre>{{ result.stdout }}</pre>
    {% endif %}
    {% if result.stderr %}
    <h5>stderr:</h5>
    <pre>{{ result.stderr }}</pre>
    {% endif %}
    {% if not result.stdout and not result.stderr %}
    <p class="text-grey">No output on stderr or stdout</p>
    {% endif %}
    {% endfor %}

    {% else %}
    <p class="text-grey">No test results available.</p>
    {% endif %}
</section>
{% endblock %}
